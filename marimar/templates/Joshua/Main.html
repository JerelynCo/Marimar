<html>

	<head>
		<title>
			Main Page
		</title>

		<!-- LINKSTYLES -->
		<link rel="stylesheet" type="text/css" href="Stylesheets/style.css">
		<link rel="stylesheet" type="text/css" href="Stylesheets/style-wrapper.css">
		<link rel="stylesheet" type="text/css" href="Stylesheets/style-main.css">
		<link rel="stylesheet" type="text/css" href="Scripts/Leaflet/leaflet.css">

		<meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />

	  	<script src="Scripts/jquery-2.1.4.min.js"></script>

	  	<script src="MetropolitantManila.json"></script>

		<script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>
		<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css">

		<script src='https://api.mapbox.com/mapbox.js/v2.2.3/mapbox.js'></script>
		<link href='https://api.mapbox.com/mapbox.js/v2.2.3/mapbox.css' rel='stylesheet' />

	</head>

	<body>
		<div class="wrapper-outer">
			<div class="wrapper-inner-border">

				<div class="wrapper-legend">
					<div class="legend-title-menu">
						<div class="legend-title">Legend</div>
					</div>
					<div class="legend-options-menu">
						<div class="legend-options"><div class="legend1"></div>&le; 1 km</div>
						<div class="legend-options"><div class="legend2"></div>&le; 2.5 km</div>
						<div class="legend-options"><div class="legend3"></div>&le; 5km</div>
						<div class="legend-options"><div class="legend4"></div>&le; 10 km</div>
						<div class="legend-options"><div class="legend5"></div>&ge; 10 km</div>
					</div>
				</div>

				<div class="wrapper-filter">
					<div class="filter-title-menu">
						<div class="filter-title">Categories</div>
					</div>
					<div class="filter-options-menu">
                        <div class="filter-options" id="PRCP">Qualified staff headed by a licensed PRC physician</div>
						<div class="filter-options" id="BedSpace">Bed Space according to DOH guidelines</div>
						<div class="filter-options" id="OpRoom">Operating room with standard equipment with provision for sterilization</div>
						<div class="filter-options" id="RecRoom">Recovery Room</div>
						<div class="filter-options" id="MatWard">Maternity Ward</div>
						<div class="filter-options" id="IsoRoom">Isolation room for infectious diseases</div>
						<div class="filter-options" id="dental">A separate dental room</div>
						<div class="filter-options" id="blood">Provision for blood station</div>
						<div class="filter-options" id="pathology">DOH licensed secondary laboratory with consulting pathologist</div>
						<div class="filter-options" id="radiology">DOH licensed level 1 imaging facility with consulting radiologist</div>
						<div class="filter-options" id="pharmacy">DOH licensed Pharmacy</div>
						<div class="filter-options" id="CMDCDH_2">Qualified staff with Chief Medical Director and certified  Clinical Department Head</div>
						<div class="filter-options" id="Spec1">With specialties in Medicine, Pediatrics, Obstetrics and Gynecology, Surgery; their subspecialties and ancillary services</div>
						<div class="filter-options" id="ICU">Provision for general ICU for critically ill patients</div>
						<div class="filter-options" id="NICU">Provision for NICU (Neonatal Intensive Care Unit)</div>
						<div class="filter-options" id="HRPU">Provision for HRPU (High Risk Pregnancy Unit)</div>
						<div class="filter-options" id="RTS">Provision for respiratory therapy services</div>
						<div class="filter-options" id="TerClin">A DOH licensed tertiary clinical laboratory</div>
						<div class="filter-options" id="Teach_3">Teaching or Training hospitals with specialties in Medicine, Pediatrics, Obstetrics and Gynecology, and Surgery</div>
						<div class="filter-options" id="PRU">Provision for physical medicine and rehabilitation unit</div>
						<div class="filter-options" id="ASC">Provision for ambulatory surgical clinic</div>
						<div class="filter-options" id="Dialysis">Provision for dialysis facility</div>
						<div class="filter-options" id="BBank">Provision for blood bank</div>
						<div class="filter-options" id="Hispa">A DOH liscensed tertiary clinical laboratory with standard equipment necessary for hispathology examinations</div>
						<div class="filter-options" id="radiology3">A DOH licensed level 3 imaging facility with interventional radiology</div>
                        <div class="filter-options" id="HIVTreat">DOH licensed HIV Treatment Facility</div>
                        <div class="filter-options" id="HIVTest">DOH licensed HIV Testing Facility</div>
                    </div>
				</div>
				<div class="wrapper-map" id="map">
					<script>
						// get color depending on population density value

						function getColor(d) {
							return d ==100 ? '#ec264f' :
							       d >= 95  ? '#ed3158' :
							       d >= 90  ? '#ee3b60' :
							       d >= 85  ? '#ef4669' :
							       d >= 80   ? '#f05172' :
							       d >= 75   ? '#f15c7b' :
							       d >= 70   ? '#f26783' :
							       d >= 65   ? '#f3728c' :
							       d >= 60   ? '#f47d95' :
							       d >= 55   ? '#f5889e' :
							       d >= 50   ? '#f592a7' :
							       d >= 45   ? '#f69db0' :
							       d >= 40   ? '#f7a8b9' :
							       d >= 35   ? '#f8b3c2' :
							       d >= 30   ? '#f9bdca' :
							       d >= 25   ? '#fac9d3' :
							       d >= 20   ? '#fbd4dc' :
							       d >= 15   ? '#fcdfe5' :
							       d >= 10   ? '#fde9ed' :
							       d >= 5   ? '#fef4f6' :
							       d >= 0   ? '#ffffff' :
							                  '#ffffff';
						}

						function getSaturation(city){
							for(var i = 0; i< count.length; i++){
							    if (city == count[i].City) {
                                    return (count[i].Count/highest * 100);
							    }
							}
							return 0;
						}

						function style(feature) {
						    return {
						        fillColor: getColor(getSaturation(feature.properties.NAME_2)),
						        weight: 2,
						        opacity: 1,
						        color: '#ec264f',
						        dashArray: '3',
						        fillOpacity: 0.7
						    };
						}
                        //
                        var highest = 0;
                        // var count = [{"City":"Kalookan","Count":6.0},{"City":"Quezon","Count":13.0},{"City":"Muntinlupa","Count":5.0},{"City":"Marikina","Count":6.0},{"City":"Pasig","Count":9.0},{"City":"Manila","Count":6.0},{"City":"Makati","Count":1.0},{"City":"Mandaluyong","Count":1.0},{"City":"Taguig","Count":1.0},{"City":"Valenzuela","Count":2.0}];
                        //
                        // for(var i=0; i<count.length; i++){
                        //         if (highest < count[i].count){
                        //             highest = count[i].count;
                        //         }
                        // }

						// PINS
						var pin1 = L.icon({
						    iconUrl: 'Stylesheets/Assets/pins_1.png',
						    shadowUrl: 'Stylesheets/Assets/pins_shadow.png',

						    iconSize:     [50, 125], // size of the icon
						    shadowSize:   [90, 125], // size of the shadow
						    iconAnchor:   [0, 0], // point of the icon which will correspond to marker's location
						    shadowAnchor: [0, 0],  // the same for the shadow
						    popupAnchor:  [-3, -76] // point from which the popup should open relative to the iconAnchor
						});

						var pin2 = L.icon({
						    iconUrl: 'Stylesheets/Assets/pins_2.png',
						    shadowUrl: 'Stylesheets/Assets/pins_shadow.png',

						    iconSize:     [50, 125], // size of the icon
						    shadowSize:   [90, 125], // size of the shadow
						    iconAnchor:   [0, 0], // point of the icon which will correspond to marker's location
						    shadowAnchor: [0, 0],  // the same for the shadow
						    popupAnchor:  [-3, -76] // point from which the popup should open relative to the iconAnchor
						});

						var pin3 = L.icon({
						    iconUrl: 'Stylesheets/Assets/pins_3.png',
						    shadowUrl: 'Stylesheets/Assets/pins_shadow.png',

						    iconSize:     [50, 125], // size of the icon
						    shadowSize:   [90, 125], // size of the shadow
						    iconAnchor:   [0, 0], // point of the icon which will correspond to marker's location
						    shadowAnchor: [0, 0],  // the same for the shadow
						    popupAnchor:  [-3, -76] // point from which the popup should open relative to the iconAnchor
						});

						var pin4 = L.icon({
						    iconUrl: 'Stylesheets/Assets/pins_4.png',
						    shadowUrl: 'Stylesheets/Assets/pins_shadow.png',

						    iconSize:     [50, 125], // size of the icon
						    shadowSize:   [90, 125], // size of the shadow
						    iconAnchor:   [0, 0], // point of the icon which will correspond to marker's location
						    shadowAnchor: [0, 0],  // the same for the shadow
						    popupAnchor:  [-3, -76] // point from which the popup should open relative to the iconAnchor
						});

						var pin5 = L.icon({
						    iconUrl: 'Stylesheets/Assets/pins_5.png',
						    shadowUrl: 'Stylesheets/Assets/pins_shadow.png',

						    iconSize:     [50, 125], // size of the icon
						    shadowSize:   [90, 125], // size of the shadow
						    iconAnchor:   [0, 0], // point of the icon which will correspond to marker's location
						    shadowAnchor: [0, 0],  // the same for the shadow
						    popupAnchor:  [-3, -76] // point from which the popup should open relative to the iconAnchor
						});

						var pinme = L.icon({
						    iconUrl: 'Stylesheets/Assets/pins_me.png',
						    shadowUrl: 'Stylesheets/Assets/pins_shadow.png',

						    iconSize:     [50, 125], // size of the icon
						    shadowSize:   [90, 125], // size of the shadow
						    iconAnchor:   [0, 0], // point of the icon which will correspond to marker's location
						    shadowAnchor: [0, 0],  // the same for the shadow
						    popupAnchor:  [-3, -76] // point from which the popup should open relative to the iconAnchor
						});
						// NO MORE PINS

						var mapboxAccessToken = 'pk.eyJ1Ijoib2ZmaWNpYWxqb3NodWEiLCJhIjoiY2loOHNqOHk4MHMxYnVra3RubDVxaWJyaiJ9.BlgD_oWpdt2hCwiYcdS2nQ';
						var map = L.map('map', 'mapbox.streets')
						    .setView([14.600657, 120.98215], 11);

						/*Using Mapbox Map*/
						L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=' + mapboxAccessToken, {
						    attribution: "<a href='https://www.mapbox.com/about/maps/'>Mapbox</a> Â© <a href='https://github.com/macoymejia/geojsonph'>geojsonph</a>",
						    id: 'mapbox.light',
						    minZoom: 10,
						    accessToken: 'pk.eyJ1Ijoib2ZmaWNpYWxqb3NodWEiLCJhIjoiY2loOHNqOHk4MHMxYnVra3RubDVxaWJyaiJ9.BlgD_oWpdt2hCwiYcdS2nQ'
						}).addTo(map);

						var layer;// = L.geoJson(metroManilaData, {style:style});
                        // layer.addTo(map);

    					L.marker([14.600657, 120.98215], {icon: pinme}).addTo(map);

                        $(".filter-options").on("click", function(){
                            $.getJSON("http://localhost:8000/citycount/" + this.id, function(result){
                                try {
                                    map.removeLayer(layer);
                                } catch (e) {

                                }
                                count = result;
                                highest = 0;
        						for(var i=0; i<count.length; i++){
                                        if (highest < count[i].Count){
                                            highest = count[i].Count;
                                        }
                                }
                                layer = L.geoJson(metroManilaData, {style:style});
                                layer.addTo(map);
                            });
                        });

					</script>
				</div>
			</div>
		</div>
	</body>

</html>
